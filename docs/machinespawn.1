.\" Automatically generated by Pandoc 2.19.2
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "MACHINESPAWN" "1" "November 16, 2022" "machinespawn" "machinespawn Manual"
.hy
.SH Machinespawn
.PP
Quickly stand up systemd_nspawn containers
.SS Introduction
.PP
A nifty and performant way to quickly create, stand up or manage
\f[V]systemd_nspawn\f[R] (https://www.freedesktop.org/software/systemd/man/systemd-nspawn.html)
containers, \f[V]machinespawn\f[R] uses
\f[V]debootstrap\f[R] (https://wiki.debian.org/Debootstrap) and
\f[V]machinectl\f[R] (https://www.freedesktop.org/software/systemd/man/machinectl.html)
and
\f[V]systemd_nspawn\f[R] (https://www.freedesktop.org/software/systemd/man/systemd-nspawn.html)
to build run and remove minimal OS images.
It is useful for that, and also as a stage to quickly build custom
container or ISO images.
.SS Warning :warning:
.PP
It is currently a work-in-progress \[u1F6A7] under heavy and rapid
development so treat as alpha software and approach with caution
\[u1F6D1].
However is already key part of the Ubuntu
Butterfly (https://github.com/butterfly-garden) build process.
.SS Requirements
.PP
This script relies on utilities, many of which are typically already
installed on most Debian or Ubuntu systems.
The following will ensure you have all you need:
.IP
.nf
\f[C]
sudo apt-get install binutils iproute2 systemd-container wget unzip
# optionally also
# open-infrastructure-container-tools
\f[R]
.fi
.PP
Specifically it requires:
.IP \[bu] 2
bash
.IP \[bu] 2
debootstrap (https://wiki.debian.org/Debootstrap)
.IP \[bu] 2
ip
.IP \[bu] 2
systemd-nspawn
.IP \[bu] 2
machinectl (https://www.freedesktop.org/software/systemd/man/machinectl.html)
.IP \[bu] 2
wget (depending on version of machinctl installed)
.SS Supported OS images
.PP
Currently the following OS Releases are supported:
.IP \[bu] 2
Debian Releases
.RS 2
.IP \[bu] 2
8 (jessie)
.IP \[bu] 2
9 (stretch)
.IP \[bu] 2
10 (buster)
.IP \[bu] 2
11 (bullseye)
.IP \[bu] 2
12 (bookworm)
.RE
.IP \[bu] 2
Ubuntu Releases
.RS 2
.IP \[bu] 2
16.04 (xenial)
.IP \[bu] 2
18.04 (bionic)
.IP \[bu] 2
20.04 (focal)
.IP \[bu] 2
22.04 (jammy)
.IP \[bu] 2
22.10 (kinetic)
.RE
.SS Architecture Support
.PP
Containers can be built for the host architecture or cross-bootstrapped
for the following machine architectures:
.IP \[bu] 2
amd64
.IP \[bu] 2
i386
.IP \[bu] 2
armhf
.IP \[bu] 2
arm64
.SS Usage
.PP
\f[V]machinespawn\f[R] currently needs to be run as root via
\f[V]sudo\f[R]
.IP
.nf
\f[C]
Usage: sudo machinespawn [command]
\f[R]
.fi
.SS Commands
.SS bootstrap
.PP
Build a machine from scratch.
.PP
The first build of a machine type and architecture may be quite heavy on
time and resource usage, but intelligent cacheing, together with
detection and use of local package caching proxies, should make this as
efficient as possible and significantly reduce subsequent builds or
re-builds
.IP
.nf
\f[C]
sudo machinespawn ubuntu-jammy bread
\f[R]
.fi
.PP
will build and bootstrap a container called \f[V]bread\f[R] using a base
\f[B]ubuntu 22.04 (jammy)\f[R] image
.SS list
.PP
List the existing images (by default these will be found in
\f[V]/var/lib/machines/\f[R])
.SS run
.PP
Spawn the container
.IP
.nf
\f[C]
sudo machinespawn run bread
\f[R]
.fi
.PP
Without parameters you will be dropped into a root \f[V]bash\f[R] shell
.SS clean-cache
.PP
Remove cached content from \f[V]/var/cache/machinespawn\f[R].
This will release space taken by downloaded packages at the expense of
needing to re-download if required.
.SS pull-tar
.IP
.nf
\f[C]
machinespawn pull-tar  <URL> <Machine Name>
\f[R]
.fi
.PP
Downloads a .tar container image from the specified URL, and makes it
available under the specified local machine name.
The URL must be of type \[lq]http://\[rq] or \[lq]https://\[rq], and
must refer to a .tar, .tar.gz, .tar.xz or .tar.bz2 archive file
.IP
.nf
\f[C]
sudo macheinespawn pull-tar  https://download.fedoraproject.org/pub/fedora/linux/releases/36/Cloud/x86_64/images/Fedora-Cloud-Base-36-1.5.x86_64.raw.xz FedoraCloudBase36
\f[R]
.fi
.SS remove
.PP
completely remove a machine from \f[V]/var/lib/machines/\f[R]
.PP
There is a channel for this project at
Discord (https://discord.gg/sNmz3uw)
.SS Reference
.IP \[bu] 2
debootstrap (https://wiki.debian.org/Debootstrap)
.IP \[bu] 2
machinectl (https://www.freedesktop.org/software/systemd/man/machinectl.html)
.IP \[bu] 2
systemd-nspawn (https://www.freedesktop.org/software/systemd/man/systemd-nspawn.html)
homepage (https://open-infrastructure.net/software/compute-tools)
.SH AUTHORS
Martin Wimpress.
